graph TD
    %% Core Application Flow
    App[App.tsx] -->|routes to| Index[Index Page]
    Index -->|uses| Chat[Chat Module]
    Index -->|uses| Voice[Voice Module]
    Index -->|uses| Settings[Settings Module]

    %% Chat Module Structure
    Chat -->|contains| CI[ChatInput]
    Chat -->|contains| CM[ChatMessage]
    Chat -->|uses| CS[Chat State]
    Chat -->|uses| CAI[AI Provider]
    
    %% Voice Module Structure
    Voice -->|contains| MB[MicrophoneButton]
    Voice -->|uses| SS[Speech Synthesis]
    Voice -->|uses| SR[Speech Recognition]
    Voice -->|uses| TP[Text Processing]

    %% Settings Module Structure
    Settings -->|contains| SD[SettingsDrawer]
    Settings -->|uses| Storage[Local Storage]
    Settings -->|configures| CAI
    Settings -->|configures| Voice

    %% AI Provider Implementation
    CAI -->|implements| AP[Anthropic Provider]
    AP -->|uses| WS[WebSocket Stream]
    AP -->|uses| Config[Environment Config]

    %% State Management
    CS -->|updates| Messages[Message Store]
    CS -->|triggers| Loading[Loading State]

    %% UI Components
    CI -->|triggers| Send[Send Message]
    MB -->|triggers| Record[Voice Recording]
    SD -->|updates| Config

    %% Cross-cutting Concerns
    Config -->|affects| AP
    Config -->|affects| SS
    Messages -->|renders| CM

    %% Component Styling
    style App fill:#f9f,stroke:#333,stroke-width:2px
    style Index fill:#bbf,stroke:#333,stroke-width:2px
    style Chat fill:#dfd,stroke:#333,stroke-width:2px
    style Voice fill:#fdd,stroke:#333,stroke-width:2px
    style Settings fill:#ddf,stroke:#333,stroke-width:2px
    
    %% Coupling Indicators
    linkStyle 3 stroke:#f00,stroke-width:2px
    linkStyle 12 stroke:#f00,stroke-width:2px
    linkStyle 13 stroke:#f00,stroke-width:2px

    %% Legend
    subgraph Legend
        L1[Core Module]
        L2[Component]
        L3[Service]
        L4[High Coupling]
    end

    style L1 fill:#bbf,stroke:#333,stroke-width:2px
    style L2 fill:#dfd,stroke:#333,stroke-width:2px
    style L3 fill:#fdd,stroke:#333,stroke-width:2px
    linkStyle 24 stroke:#f00,stroke-width:2px